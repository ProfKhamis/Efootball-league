<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eFootball Tournament Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #e0e0e3;
            transition: background-color 0.3s ease;
            color: #4a4a4a;
        }
        .neumorphic-card {
            background: #e0e0e3;
            box-shadow: 8px 8px 20px #c3c3c6, -8px -8px 20px #ffffff;
            border-radius: 2rem;
            transition: all 0.3s ease;
        }
        .neumorphic-card:hover {
            box-shadow: 4px 4px 12px #c3c3c6, -4px -4px 12px #ffffff;
            transform: translateY(-2px);
        }
        .neumorphic-button {
            background: #e0e0e3;
            box-shadow: 4px 4px 10px #c3c3c6, -4px -4px 10px #ffffff;
            transition: all 0.2s ease-in-out;
            border-radius: 9999px;
            font-weight: 500;
        }
.neumorphic-button:hover {
            box-shadow: 2px 2px 8px #c3c3c6, -2px -2px 8px #ffffff;
            transform: scale(0.98);
        }
        .neumorphic-button:active, .active-nav {
            box-shadow: inset 4px 4px 8px #c3c3c6, inset -4px -4px 8px #ffffff;
            background: #d0d0d3;
            transform: scale(0.96);
        }
        .neumorphic-inset {
            background: #e0e0e3;
            box-shadow: inset 4px 4px 8px #c3c3c6, inset -4px -4px 8px #ffffff;
            border-radius: 2rem;
        }
        .neumorphic-input {
            background: #e0e0e3;
            box-shadow: inset 2px 2px 6px #c3c3c6, inset -2px -2px 6px #ffffff;
            border-radius: 9999px;
        }
        .table-row-container {
            margin: 0.5rem 0;
            transition: all 0.3s ease;
        }
        .table-row-container:hover {
            box-shadow: 2px 2px 6px #c3c3c6, -2px -2px 6px #ffffff;
        }

   /* --- New CSS for Top-Left Expandable Menu --- */
        .nav-container {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 50;
            width: 100%;
            display: flex;
            align-items: center;
            padding: 1rem;
        }
        .nav-menu {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 250px;
            padding: 2rem 1rem;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            z-index: 50;
            border-radius: 0 2rem 2rem 0;
            box-shadow: 8px 8px 20px #c3c3c6, -8px -8px 20px #ffffff;
        }
        .nav-menu.open {
            transform: translateX(0);
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 40;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

     .overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }
        .nav-toggle-btn {
            z-index: 60;
        }
        .nav-link {
            justify-content: flex-start;
        }

        @media (min-width: 768px) {
            .nav-container {
                position: relative;
                justify-content: center;
                gap: 2rem;
            }
            .nav-toggle-btn, .overlay {
                display: none;
            }
            .nav-menu {
                position: relative;
                height: auto;
                width: auto;
                transform: translateX(0);
                padding: 1rem;
                display: flex;
                flex-direction: row;
                justify-content: center;
                gap: 2rem;
                border-radius: 2rem;
                box-shadow: 8px 8px 20px #c3c3c6, -8px -8px 20px #ffffff;
            }

    .nav-link {
                flex-direction: row;
                justify-content: center;
            }
            .nav-link span {
                margin-left: 0.5rem;
            }
        }
        /* Style for the image preview in modal */
        #image-preview {
            max-width: 100%;
            height: auto;
            border-radius: 1rem;
            margin-bottom: 1rem;
        }
        
    </style>

</head>
<body class="bg-[#e0e0e3] min-h-screen text-gray-700">

    <!-- Top Navigation Container -->
    <div class="nav-container md:p-12 p-4">
        <button id="nav-toggle-btn" class="nav-toggle-btn w-12 h-12 p-2 neumorphic-button hover:bg-[#d0d0d3] rounded-full">
            <svg class="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
        </button>

        <nav id="nav-menu" class="nav-menu neumorphic-card flex flex-col items-start gap-4">
            <a href="#" class="nav-link flex items-center w-full p-3 font-semibold text-base neumorphic-button active-nav" data-page="home">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1"></path></svg>
                <span>Home</span>
            </a>

    <a href="#" class="nav-link flex items-center w-full p-3 font-semibold text-base neumorphic-button" data-page="groups">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm6-12a4 4 0 110 5.292M15 21v-1a6 6 0 00-9 0v1m3-13l2.87-2.87a1 1 0 011.414 0l2.87 2.87M15 11l-2.87 2.87a1 1 0 01-1.414 0L8 11"></path></svg>
                <span>Groups</span>
            </a>
            <a href="#" class="nav-link flex items-center w-full p-3 font-semibold text-base neumorphic-button" data-page="uefa">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 10.118a1 1 0 010-2.236v2.236zM11 10.118a1 1 0 010-2.236M11 10.118a1 1 0 010-2.236m0-2.236a1 1 0 010-2.236m0 4.472a1 1 0 010-2.236m0 2.236L12 12m-1 0a1 1 0 010-2.236m0 2.236a1 1 0 010-2.236m0 2.236a1 1 0 010-2.236m0 2.236L12 12"></path></svg>

 <span>UEFA</span>
            </a>
            <a href="#" class="nav-link flex items-center w-full p-3 font-semibold text-base neumorphic-button" data-page="europa">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <span>Europa</span>
            </a>
            <a href="#" class="nav-link flex items-center w-full p-3 font-semibold text-base neumorphic-button" data-page="fixtures">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h.01M16 11h.01M9 15h.01M15 15h.01M11 19h.01M7 19h.01M17 19h.01M3 11v12a2 2 0 002 2h14a2 2 0 002-2V11m-18 0H3m18 0H3m18-6v6a2 2 0 01-2 2H5a2 2 0 01-2-2V5M16 3H8M16 3a2 2 0 002-2v0a2 2 0 00-2-2h-8a2 2 0 00-2 2v0a2 2 0 002 2h8z"></path></svg>

<span>Fixtures</span>
            </a>
            <a href="#" class="nav-link flex items-center w-full p-3 font-semibold text-base neumorphic-button" data-page="history">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 0v.01M9 5h6"></path></svg>
                <span>Match History</span>
            </a>
            <a href="#" class="nav-link flex items-center w-full p-3 font-semibold text-base neumorphic-button" data-page="admin">

   <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608.996 2.924 0 3.35z"></path></svg>
                <span>Admin Panel</span>
            </a>
        </nav>
        <div id="overlay" class="overlay"></div>
    </div>
      <!-- Main Content Container -->
    <main class="p-4 md:p-12 mt-16 md:mt-0">
        <div id="content" class="w-full max-w-7xl mx-auto min-h-[calc(100vh-160px)]">
            <!-- Dynamic content will be rendered here -->
        </div>
    </main>

    <!-- Generic Modal Popup -->
    <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900 bg-opacity-50 backdrop-blur-sm transition-opacity duration-300">
        <div id="modal-content" class="neumorphic-card p-6 md:p-8 rounded-[2rem] w-full max-w-md">
            <h3 id="modal-title" class="text-xl font-bold mb-4 text-center"></h3>
            <div id="modal-body"></div>
            <div class="mt-6 text-center">
                <button id="modal-close" class="neumorphic-button py-2 px-6 font-bold">Close</button>
            </div>
        </div>
    </div>
    <script>
        // Define a custom Tailwind config for single file
        tailwind.config = {
            theme: {
                extend: {
                    boxShadow: {
                        'neumorphic-card': '8px 8px 20px #c3c3c6, -8px -8px 20px #ffffff',
                        'neumorphic-card-hover': '4px 4px 12px #c3c3c6, -4px -4px 12px #ffffff',
                        'neumorphic-button': '4px 4px 10px #c3c3c6, -4px -4px 10px #ffffff',
                        'neumorphic-button-active': 'inset 4px 4px 8px #c3c3c6, inset -4px -4px 8px #ffffff',
                        'neumorphic-input': 'inset 2px 2px 6px #c3c3c6, inset -2px -2px 6px #ffffff',
                    }
                }
            }
        };

const contentDiv = document.getElementById('content');
        const navLinks = document.querySelectorAll('.nav-link');
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modal-body');
        const modalTitle = document.getElementById('modal-title');
        const modalCloseBtn = document.getElementById('modal-close');
        
        // --- Data Management (LocalStorage) ---
        const TEAMS_COUNT = 20;
        const TEAM_NAMES = [
    "LEFTFOOT MAGIC", "MBOMBOCLAT", "MEGAðŸ¤¬", "Ã‡â‚¬ÃƒSâ‚¬R", "CHELSEA",
    "ÃœNRÃœLLY", "SCAVANGERS", "FCMKHI99", "MANCHESTER UNITED", "ALLAN FC", "FARO BV", "TYCOON",
    "JEONJU G", "SHAKUR254", "LEGEND KILLER", "PUMAS FC", "HAVE MERCY",
    "THE RALPH", "LONDON BUOY", "A-L-F-R-3-D"
];
          let data = {
            teams: [],
            groups: {},
            fixtures: [],
            matchHistory: [],
            settings: {
                darkMode: false,
                currentStage: 'Group Stage'
            }
        };

        const saveData = () => {
            localStorage.setItem('tournamentData', JSON.stringify(data));
        };

        const loadData = () => {
            const storedData = localStorage.getItem('tournamentData');
            if (storedData) {
                data = JSON.parse(storedData);
            } else {
                initializeData();
            }
        };
const initializeData = () => {
            data.teams = TEAM_NAMES.map((name, index) => ({
                id: index + 1,
                name: name,
                wins: 0,
                draws: 0,
                losses: 0,
                goalsFor: 0,
                goalsAgainst: 0,
                points: 0,
            }));

            const shuffledTeams = [...data.teams].sort(() => 0.5 - Math.random());
            const groupNames = ['A', 'B', 'C', 'D', 'E'];
            data.groups = {};
            for (let i = 0; i < groupNames.length; i++) {
                data.groups[groupNames[i]] = shuffledTeams.slice(i * 4, (i + 1) * 4).map(t => t.id);
            }

data.fixtures = [];
            for (const group of groupNames) {
                const teamIds = data.groups[group];
                let matchdayCounter = 1;
                let matchesPerMatchday = 2;
                let matchCounter = 0;

                const pairings = [];
                for (let i = 0; i < teamIds.length; i++) {
                    for (let j = i + 1; j < teamIds.length; j++) {
                        pairings.push([teamIds[i], teamIds[j]]);
                    }
                }

pairings.sort(() => 0.5 - Math.random());
                
                pairings.forEach((pairing, index) => {
                     data.fixtures.push({
                        id: crypto.randomUUID(),
                        teamAId: pairing[0],
                        teamBId: pairing[1],
                        round: 'Group Stage',
                        group: group,
                        matchday: `Matchday ${matchdayCounter}`,
                        status: 'Upcoming',
                        date: new Date().toISOString().slice(0, 10),
                        scoreA: null,
                        scoreB: null,
                    });
                    matchCounter++;
                    if (matchCounter >= matchesPerMatchday && matchdayCounter < 3) {
                         matchdayCounter++;
                         matchCounter = 0;
                    }
                });
            }
            saveData();
        };
const getTeamById = (id) => data.teams.find(team => team.id === id);

        const calculateStandings = (groupName) => {
            const teamIds = data.groups[groupName];
            const teamsInGroup = teamIds.map(id => {
                const team = getTeamById(id);
                team.wins = 0;
                team.draws = 0;
                team.losses = 0;
                team.goalsFor = 0;
                team.goalsAgainst = 0;
                return team;
            });

            const groupMatches = data.matchHistory.filter(m => m.group === groupName);
            groupMatches.forEach(match => {
                const teamA = teamsInGroup.find(t => t.id === match.teamAId);
                const teamB = teamsInGroup.find(t => t.id === match.teamBId);
                if (!teamA || !teamB) return;

                teamA.goalsFor += match.scoreA;
                teamA.goalsAgainst += match.scoreB;
                teamB.goalsFor += match.scoreB;
                teamB.goalsAgainst += match.scoreA;

                if (match.scoreA > match.scoreB) {
                    teamA.wins += 1;
                    teamB.losses += 1;
                } else if (match.scoreA < match.scoreB) {
                    teamB.wins += 1;
                    teamA.losses += 1;
                } else {
                    teamA.draws += 1;
                    teamB.draws += 1;
                }
            });

teamsInGroup.forEach(team => {
                team.points = (team.wins * 3) + (team.draws * 1);
                team.gd = team.goalsFor - team.goalsAgainst;
            });

            return teamsInGroup.sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.gd !== a.gd) return b.gd - a.gd;
                return b.goalsFor - a.goalsFor;
            });
        };

 // --- UI Rendering Functions ---
        const showPage = (pageName) => {
            const pageMap = {
                'home': renderHomePage,
                'groups': renderGroupsPage,
                'uefa': renderUefaPage,
                'europa': renderEuropaPage,
                'fixtures': renderFixturesPage,
                'history': renderMatchHistoryPage,
                'admin': renderAdminPanel,
            };
            if (pageMap[pageName]) {
                contentDiv.innerHTML = '';
                pageMap[pageName]();
            }
            navLinks.forEach(link => {
                link.classList.remove('active-nav');
                if (link.dataset.page === pageName) {
                    link.classList.add('active-nav');
                }
            });
        };

const renderHomePage = () => {
            const matchesPlayed = data.matchHistory.length;
            const upcomingFixtures = data.fixtures.length;
            const totalTeams = data.teams.length;
            
            contentDiv.innerHTML = `
                <div class="space-y-6">
                    <h1 class="text-2xl md:text-3xl lg:text-5xl font-bold text-center mb-6">Tournament Overview</h1>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="p-6 neumorphic-card text-center flex flex-col items-center">
                            <h2 class="text-lg md:text-xl font-semibold mb-2">Total Teams</h2>
                            <p class="text-3xl md:text-4xl lg:text-5xl font-bold">${totalTeams}</p>
                        </div>
                        <div class="p-6 neumorphic-card text-center flex flex-col items-center">
                            <h2 class="text-lg md:text-xl font-semibold mb-2">Current Stage</h2>
                            <p class="text-2xl md:text-3xl lg:text-4xl font-bold">${data.settings.currentStage}</p>
                        </div>
 <div class="p-6 neumorphic-card text-center flex flex-col items-center">
                            <h2 class="text-lg md:text-xl font-semibold mb-2">Matches Played</h2>
                            <p class="text-3xl md:text-4xl lg:text-5xl font-bold">${matchesPlayed}</p>
                        </div>
                        <div class="p-6 neumorphic-card text-center flex flex-col items-center">
                            <h2 class="text-lg md:text-xl font-semibold mb-2">Upcoming Fixtures</h2>
                            <p class="text-3xl md:text-4xl lg:text-5xl font-bold">${upcomingFixtures}</p>
                        </div>
                    </div>
                </div>
            `;
        };

const renderGroupsPage = () => {
            const groupNames = Object.keys(data.groups);
            contentDiv.innerHTML = `
                <div class="space-y-6">
                    <h1 class="text-2xl md:text-3xl lg:text-5xl font-bold text-center mb-6">Group Stage Standings</h1>
                    <div id="group-tabs" class="neumorphic-inset p-2 flex justify-center flex-wrap gap-2 md:gap-4 rounded-[2rem] mb-6">
                        <button class="group-tab py-2 px-6 font-semibold neumorphic-button hover:bg-[#d0d0d3] active-tab active-nav" data-group="all">All Groups</button>
                        ${groupNames.map((name, index) => `
                            <button class="group-tab py-2 px-6 font-semibold neumorphic-button hover:bg-[#d0d0d3]" data-group="${name}">Group ${name}</button>
                        `).join('')}
                    </div>
                    <div id="group-content"></div>
                </div>
            `;

    const groupTabs = document.querySelectorAll('.group-tab');
            const groupContentDiv = document.getElementById('group-content');
            
            const displayGroup = (groupName) => {
                if (groupName === 'all') {
                    displayAllGroups();
                    return;
                }
                const standings = calculateStandings(groupName);
                groupContentDiv.innerHTML = `
                    <div class="neumorphic-card p-4 md:p-6 rounded-[2rem] overflow-x-auto">
                        <h2 class="text-xl md:text-2xl font-bold mb-4 text-center">Group ${groupName}</h2>
                        <table class="w-full text-left table-auto border-separate" style="border-spacing: 0 0.5rem;">

   <thead>
                                <tr class="text-gray-500 uppercase text-xs md:text-sm">
                                    <th class="py-2 px-2 md:px-4 rounded-tl-lg rounded-bl-lg">Team</th>
                                    <th class="py-2 px-2 md:px-4 text-center">W</th>
                                    <th class="py-2 px-2 md:px-4 text-center">D</th>
                                    <th class="py-2 px-2 md:px-4 text-center">L</th>
                                    <th class="hidden md:table-cell py-2 px-4 text-center">GF</th>
                                    <th class="hidden md:table-cell py-2 px-4 text-center">GA</th>
                                    <th class="py-2 px-2 md:px-4 text-center">GD</th>
                                    <th class="py-2 px-2 md:px-4 rounded-tr-lg rounded-br-lg text-center">Pts</th>
                                </tr>
                            </thead>

     <tbody>
                                ${standings.map(team => `
                                    <tr class="table-row-container neumorphic-button hover:neumorphic-card rounded-2xl">
                                        <td class="py-3 px-2 md:px-4 rounded-l-2xl font-semibold">${team.name}</td>
                                        <td class="py-3 px-2 md:px-4 text-center">${team.wins}</td>
                                        <td class="py-3 px-2 md:px-4 text-center">${team.draws}</td>
                                        <td class="py-3 px-2 md:px-4 text-center">${team.losses}</td>
                                        <td class="hidden md:table-cell py-3 px-4 text-center">${team.goalsFor}</td>
                                        <td class="hidden md:table-cell py-3 px-4 text-center">${team.goalsAgainst}</td>
                                        <td class="py-3 px-2 md:px-4 text-center">${team.gd}</td>
                                        <td class="py-3 px-2 md:px-4 rounded-r-2xl font-bold text-center">${team.points}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            };

const displayAllGroups = () => {
                const allGroupsHtml = Object.keys(data.groups).map(groupName => {
                    const standings = calculateStandings(groupName);
                    return `
                        <div class="neumorphic-card p-4 md:p-6 rounded-[2rem] overflow-x-auto mb-6">
                            <h2 class="text-xl md:text-2xl font-bold mb-4 text-center">Group ${groupName}</h2>
                            <table class="w-full text-left table-auto border-separate" style="border-spacing: 0 0.5rem;">
                                <thead>
                                    <tr class="text-gray-500 uppercase text-xs md:text-sm">
                                        <th class="py-2 px-2 md:px-4 rounded-tl-lg rounded-bl-lg">Team</th>
                                        <th class="py-2 px-2 md:px-4 text-center">W</th>
                                        <th class="py-2 px-2 md:px-4 text-center">D</th>
                                        <th class="py-2 px-2 md:px-4 text-center">L</th>

<th class="hidden md:table-cell py-2 px-4 text-center">GF</th>
                                        <th class="hidden md:table-cell py-2 px-4 text-center">GA</th>
                                        <th class="py-2 px-2 md:px-4 text-center">GD</th>
                                        <th class="py-2 px-2 md:px-4 rounded-tr-lg rounded-br-lg text-center">Pts</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${standings.map(team => `
                                        <tr class="table-row-container neumorphic-button hover:neumorphic-card rounded-2xl">
                                            <td class="py-3 px-2 md:px-4 rounded-l-2xl font-semibold">${team.name}</td>
                                            <td class="py-3 px-2 md:px-4 text-center">${team.wins}</td>
                                            <td class="py-3 px-2 md:px-4 text-center">${team.draws}</td>
                                            <td class="py-3 px-2 md:px-4 text-center">${team.losses}</td>
                                            <td class="hidden md:table-cell py-3 px-4 text-center">${team.goalsFor}</td>
    <td class="hidden md:table-cell py-3 px-4 text-center">${team.goalsAgainst}</td>
                                            <td class="py-3 px-2 md:px-4 text-center">${team.gd}</td>
                                            <td class="py-3 px-2 md:px-4 rounded-r-2xl font-bold text-center">${team.points}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }).join('');
                groupContentDiv.innerHTML = allGroupsHtml;
            };

groupTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    groupTabs.forEach(t => t.classList.remove('active-nav'));
                    tab.classList.add('active-nav');
                    displayGroup(tab.dataset.group);
                });
            });

            displayGroup('all'); // Default to showing all groups
        };

        const renderUefaPage = () => {
            contentDiv.innerHTML = `
                <div class="space-y-6">
                    <h1 class="text-2xl md:text-3xl lg:text-5xl font-bold text-center mb-6">UEFA Knockout Bracket</h1>
                    <div class="p-6 neumorphic-card">
                        <p class="text-center text-gray-500">This is a placeholder for the UEFA knockout bracket. It will be dynamically generated after the group stage concludes.</p>
                        <div class="flex justify-center items-center h-64">
<svg class="w-full h-full" viewBox="0 0 400 300" preserveAspectRatio="xMidYMid meet">
                                <path d="M 50 50 H 150 V 150 H 250 M 50 250 H 150 V 150" fill="none" stroke="#a0a0a0" stroke-width="4" stroke-linecap="round"/>
                                <circle cx="50" cy="50" r="10" fill="#a0a0a0" />
                                <circle cx="50" cy="250" r="10" fill="#a0a0a0" />
                                <circle cx="250" cy="150" r="10" fill="#a0a0a0" />
                            </svg>
                        </div>
                    </div>
                </div>
            `;
        };

const renderEuropaPage = () => {
            contentDiv.innerHTML = `
                <div class="space-y-6">
                    <h1 class="text-2xl md:text-3xl lg:text-5xl font-bold text-center mb-6">Europa Knockout Bracket</h1>
                    <div class="p-6 neumorphic-card">
                        <p class="text-center text-gray-500">This is a placeholder for the Europa knockout bracket. It will be dynamically generated after the group stage concludes.</p>
                        <div class="flex justify-center items-center h-64">
                            <svg class="w-full h-full" viewBox="0 0 400 300" preserveAspectRatio="xMidYMid meet">
                                <path d="M 50 50 H 150 V 150 H 250 M 50 250 H 150 V 150" fill="none" stroke="#a0a0a0" stroke-width="4" stroke-linecap="round"/>
                                <circle cx="50" cy="50" r="10" fill="#a0a0a0" />
                                <circle cx="50" cy="250" r="10" fill="#a0a0a0" />
                                <circle cx="250" cy="150" r="10" fill="#a0a0a0" />
                            </svg>
                        </div>
                    </div>
                </div>
            `;
        };
        const renderFixturesPage = () => {
            const groupNames = Object.keys(data.groups);
            const fixturesByGroupAndMatchday = {};

            groupNames.forEach(groupName => {
                fixturesByGroupAndMatchday[groupName] = {};
                const groupFixtures = data.fixtures.filter(f => f.group === groupName);
                
                groupFixtures.forEach(f => {
                    const matchday = f.matchday;
                    if (!fixturesByGroupAndMatchday[groupName][matchday]) {
                        fixturesByGroupAndMatchday[groupName][matchday] = [];
                    }
                    fixturesByGroupAndMatchday[groupName][matchday].push(f);
                });
            });

            const html = `
                <div class="space-y-6">
                    <h1 class="text-2xl md:text-3xl lg:text-5xl font-bold text-center mb-6">Upcoming Fixtures</h1>
                    <div id="fixtures-container" class="space-y-6">
                        ${groupNames.map(groupName => `
                            <div class="space-y-6">

 ${Object.keys(fixturesByGroupAndMatchday[groupName]).map(matchday => {
                                    const containerId = `share-container-${groupName}-${matchday.replace(/\s+/g, '-')}`;
                                    return `
                                        <div class="neumorphic-card p-4 md:p-6">
                                            <div class="flex items-center justify-between mb-4">
                                                <h2 class="text-xl md:text-2xl font-bold text-gray-600">Group ${groupName} - ${matchday}</h2>
                                                <button class="share-image-btn neumorphic-button py-2 px-4 text-sm" data-target-id="${containerId}">
                                                    Share as Image
                                                </button>
                                            </div>
                                            <div id="${containerId}" class="p-4 neumorphic-inset rounded-[1.5rem]">
                                                <h3 class="text-lg font-bold text-center mb-4">Group ${groupName} Fixtures</h3>
                                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

 ${fixturesByGroupAndMatchday[groupName][matchday].map(f => `
                                                        <div class="p-4 neumorphic-button rounded-[1.5rem] flex flex-col justify-between items-center text-center hover:neumorphic-card">
                                                            <p class="text-xs text-gray-500 mb-1">${f.date}</p>
                                                            <h3 class="text-base font-bold">${getTeamById(f.teamAId).name}</h3>
                                                            <span class="text-gray-500 font-semibold text-xs">vs</span>
                                                            <h3 class="text-base font-bold">${getTeamById(f.teamBId).name}</h3>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
contentDiv.innerHTML = html;

            document.querySelectorAll('.share-image-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const targetId = e.currentTarget.dataset.targetId;
                    generateImageForMatchday(targetId);
                });
            });
        };
        
        const generateImageForMatchday = (elementId) => {
            const element = document.getElementById(elementId);
            if (!element) {
                openModal('Error', 'Could not find the selected element to generate an image.');
                return;
            }

       // Show a temporary loading message in the modal
            openModal('Generating Image...', '<p class="text-center">Please wait while the image is being created...</p>');

            html2canvas(element, {
                backgroundColor: '#e0e0e3', // Match the body background
                scale: 2 // Increase scale for better quality
            }).then(canvas => {
                const imageUrl = canvas.toDataURL('image/png');
                const downloadLink = document.createElement('a');
                downloadLink.href = imageUrl;
                downloadLink.download = `${elementId}.png`;

                modalTitle.textContent = 'Share Fixtures';
                modalContent.innerHTML = `
                    <div class="flex flex-col items-center">
                        <img id="image-preview" src="${imageUrl}" alt="Fixtures" class="mb-4">
                        <p class="text-center text-sm text-gray-600 mb-4">
                            Your image is ready! Please download it and share it from your phone's gallery.
                        </p>
                        <button id="download-image-btn" class="neumorphic-button py-3 px-6 font-bold">Download Image</button>
                    </div>
                `;

document.getElementById('download-image-btn').addEventListener('click', () => {
                    downloadLink.click();
                    closeModal();
                });
            }).catch(error => {
                console.error('oops, something went wrong!', error);
                openModal('Error', `<p class="text-center text-red-500">Failed to generate image. Error: ${error.message}</p>`);
            });
        };

        const renderMatchHistoryPage = () => {
            const history = data.matchHistory;
            contentDiv.innerHTML = `
                <div class="space-y-6">
                    <h1 class="text-2xl md:text-3xl lg:text-5xl font-bold text-center mb-6">Match History</h1>
                    <div class="flex justify-center">
                        <input type="text" id="history-search" class="w-full max-w-lg p-3 neumorphic-input focus:outline-none" placeholder="Search by team or date...">
                    </div>
                    <div id="history-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${history.map(m => `
                            <div class="p-4 neumorphic-card">
                                <div class="flex items-center justify-between mb-2">
                                    <h3 class="text-lg font-bold">${getTeamById(m.teamAId).name} vs ${getTeamById(m.teamBId).name}</h3>
                                    <span class="text-xl font-bold">${m.scoreA} - ${m.scoreB}</span>
                                </div>
                                <p class="text-xs text-gray-500">${m.round} | ${m.date}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

    const searchInput = document.getElementById('history-search');
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const filteredHistory = data.matchHistory.filter(m => 
                    getTeamById(m.teamAId).name.toLowerCase().includes(query) ||
                    getTeamById(m.teamBId).name.toLowerCase().includes(query) ||
                    m.date.includes(query)
                );
                const historyList = document.getElementById('history-list');
                historyList.innerHTML = filteredHistory.map(m => `
                    <div class="p-4 neumorphic-card">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-lg font-bold">${getTeamById(m.teamAId).name} vs ${getTeamById(m.teamBId).name}</h3>
                            <span class="text-xl font-bold">${m.scoreA} - ${m.scoreB}</span>
                        </div>
                        <p class="text-xs text-gray-500">${m.round} | ${m.date}</p>
                    </div>
                `).join('');
            });
        };

const renderAdminPanel = () => {
            const totalTeams = data.teams.length;
            const matchesPlayed = data.matchHistory.length;
            const pendingFixtures = data.fixtures.length;
            
            contentDiv.innerHTML = `
                <div class="space-y-6">
                    <h1 class="text-2xl md:text-3xl lg:text-5xl font-bold text-center mb-6">Admin Dashboard</h1>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="p-4 neumorphic-card text-center">
                            <h2 class="text-lg font-semibold mb-1">Teams</h2>
                            <p class="text-3xl md:text-4xl font-bold">${totalTeams}</p>
                        </div>
                        <div class="p-4 neumorphic-card text-center">
                            <h2 class="text-lg font-semibold mb-1">Matches Played</h2>
                            <p class="text-3xl md:text-4xl font-bold">${matchesPlayed}</p>
                        </div>
                        <div class="p-4 neumorphic-card text-center">
                            <h2 class="text-lg font-semibold mb-1">Pending Fixtures</h2>
                            <p class="text-3xl md:text-4xl font-bold">${pendingFixtures}</p>
                        </div>
                        <div class="p-4 neumorphic-card text-center">
                            <h2 class="text-lg font-semibold mb-1">Current Stage</h2>
                            <p class="text-lg md:text-xl font-bold">${data.settings.currentStage}</p>
                        </div>
                    </div>

   <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-6">
                        <button id="add-team-btn" class="neumorphic-button py-3 px-6 font-bold">Add Team</button>
                        <button id="submit-score-btn" class="neumorphic-button py-3 px-6 font-bold">Submit Score</button>
                        <button id="end-season-btn" class="neumorphic-button py-3 px-6 font-bold">End Season</button>
                        <button id="reset-standings-btn" class="neumorphic-button py-3 px-6 font-bold">Reset Standings</button>
                    </div>
                    <div class="flex justify-center items-center mt-6">
                        <span class="mr-4">Dark Mode</span>
                        <div id="dark-mode-toggle" class="w-16 h-8 flex items-center neumorphic-inset rounded-full p-1 cursor-pointer">
                            <div class="w-6 h-6 rounded-full neumorphic-button neumorphic-card transition-transform duration-300 transform translate-x-0"></div>
                        </div>
                    </div>
                </div>
            `;
               // Event listeners for admin buttons
            document.getElementById('add-team-btn').addEventListener('click', showAddTeamModal);
            document.getElementById('submit-score-btn').addEventListener('click', showSubmitScoreModal);
            document.getElementById('end-season-btn').addEventListener('click', showEndSeasonConfirmation);
            document.getElementById('reset-standings-btn').addEventListener('click', showResetConfirmation);
            
            // Dark mode toggle
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const toggleBall = darkModeToggle.querySelector('div');
            
            const setDarkMode = (isDark) => {
                data.settings.darkMode = isDark;
                document.body.classList.toggle('bg-gray-800', isDark);
                document.body.classList.toggle('text-gray-100', isDark);
                document.body.classList.toggle('bg-[#e0e0e3]', !isDark);
                document.body.classList.toggle('text-gray-700', !isDark);
                
                if (isDark) {
                    toggleBall.classList.add('translate-x-full', 'bg-gray-700');
                    toggleBall.classList.remove('translate-x-0', 'bg-[#d0d0d3]');
                } else {
                    toggleBall.classList.remove('translate-x-full', 'bg-gray-700');
                    toggleBall.classList.add('translate-x-0', 'bg-[#d0d0d3]');
                }
                saveData();
            };

darkModeToggle.addEventListener('click', () => {
                setDarkMode(!data.settings.darkMode);
            });
            setDarkMode(data.settings.darkMode);
        };
        
        // --- Modals ---
        const openModal = (title, bodyHtml) => {
            modalTitle.textContent = title;
            modalContent.innerHTML = bodyHtml;
            modal.classList.remove('hidden');
        };

        const closeModal = () => {
            modal.classList.add('hidden');
        };

        modalCloseBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });

const showAddTeamModal = () => {
            openModal('Add New Team', `
                <form id="add-team-form" class="space-y-4">
                    <input type="text" id="new-team-name" placeholder="Team Name" class="w-full p-3 neumorphic-input focus:outline-none" required>
                    <button type="submit" class="w-full py-3 neumorphic-button font-bold">Add Team</button>
                </form>
            `);
            document.getElementById('add-team-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const newTeamName = document.getElementById('new-team-name').value;
                const newTeamId = data.teams.length > 0 ? Math.max(...data.teams.map(t => t.id)) + 1 : 1;
                data.teams.push({
                    id: newTeamId,
                    name: newTeamName,
                    wins: 0, draws: 0, losses: 0, goalsFor: 0, goalsAgainst: 0, points: 0
                });
                saveData();
                closeModal();
                showPage('admin');
            });
        };

const showSubmitScoreModal = () => {
            const upcoming = data.fixtures.filter(f => f.status === 'Upcoming');
            if (upcoming.length === 0) {
                openModal('Submit Score', '<p class="text-center text-gray-600">No upcoming fixtures to score.</p>');
                return;
            }
            openModal('Submit Match Score', `
                <form id="score-form" class="space-y-4">
                    <select id="match-select" class="w-full p-3 neumorphic-input focus:outline-none" required>
                        <option value="">-- Select a Match --</option>
                        ${upcoming.map(f => `
                            <option value="${f.id}">${getTeamById(f.teamAId).name} vs ${getTeamById(f.teamBId).name}</option>
                        `).join('')}
                    </select>
                    <div class="flex items-center justify-between">
                        <input type="number" id="score-a" placeholder="Score A" class="w-1/3 p-3 neumorphic-input focus:outline-none" required>
                        <span class="mx-2 font-bold">-</span>
                        <input type="number" id="score-b" placeholder="Score B" class="w-1/3 p-3 neumorphic-input focus:outline-none" required>
                    </div>
                    <button type="submit" class="w-full py-3 neumorphic-button font-bold">Submit Score</button>
                </form>
            `);

document.getElementById('score-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const matchId = document.getElementById('match-select').value;
                const scoreA = parseInt(document.getElementById('score-a').value);
                const scoreB = parseInt(document.getElementById('score-b').value);
                if (!matchId || isNaN(scoreA) || isNaN(scoreB)) return;

                const match = data.fixtures.find(f => f.id === matchId);
                if (match) {
                    const completedMatch = { ...match, scoreA: scoreA, scoreB: scoreB, status: 'Completed', date: new Date().toISOString().slice(0, 10) };
                    data.matchHistory.push(completedMatch);
                    data.fixtures = data.fixtures.filter(f => f.id !== matchId);
                    saveData();
                }
                closeModal();
                showPage('admin');
            });
        };
        const showEndSeasonConfirmation = () => {
            openModal('End Season', `
                <p class="text-center mb-4">Are you sure you want to end the season? This will move all remaining fixtures to history and finalize all standings.</p>
                <div class="flex justify-center gap-4">
                    <button id="confirm-end-season" class="neumorphic-button py-2 px-6 font-bold bg-red-500 text-white">Confirm</button>
                    <button class="neumorphic-button py-2 px-6 font-bold" onclick="closeModal()">Cancel</button>
                </div>
            `);
            document.getElementById('confirm-end-season').addEventListener('click', () => {
                data.matchHistory.push(...data.fixtures.map(f => ({...f, status: 'Completed', scoreA: null, scoreB: null})));
                data.fixtures = [];
                data.settings.currentStage = 'Season Ended';
                saveData();
                closeModal();
                showPage('admin');
            });
        };

const showResetConfirmation = () => {
            openModal('Reset All Standings', `
                <p class="text-center mb-4">This action will reset all team stats and match history. This is irreversible.</p>
                <div class="flex justify-center gap-4">
                    <button id="confirm-reset" class="neumorphic-button py-2 px-6 font-bold bg-red-500 text-white">Confirm</button>
                    <button class="neumorphic-button py-2 px-6 font-bold" onclick="closeModal()">Cancel</button>
                </div>
            `);
            document.getElementById('confirm-reset').addEventListener('click', () => {
                localStorage.removeItem('tournamentData');
                loadData();
                closeModal();
                showPage('admin');
            });
        };

        // --- Initial Load ---
        window.onload = () => {
            loadData();
            showPage('home');
        };

        // --- Event Listeners for Navigation ---
        const navToggleBtn = document.getElementById('nav-toggle-btn');
        const navMenu = document.getElementById('nav-menu');
        const overlay = document.getElementById('overlay');

        const toggleMenu = () => {
            navMenu.classList.toggle('open');
            overlay.classList.toggle('visible');
        };

        navToggleBtn.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', toggleMenu);
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = e.currentTarget.dataset.page;
                showPage(page);
                if (window.innerWidth < 768) {
                    toggleMenu();
                }
            });
        });
    </script>
</body>
</html>



